<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Revision Test</title>
    <style>
        /* --- 1. CORPORATE IDENTITY & VARS --- */
        :root {
            --primary-blue: #2D75C8;
            --secondary-blue: #1A5494;
            --highlight-orange: #F68B1F;
            --success-green: #5AB646;
            --bg-color: #F4F7FB;
            --text-dark: #333333;
            --text-grey: #666666;
            --card-shadow: 0 8px 24px rgba(0,0,0,0.05);
            --input-border: #E0E0E0;
        }
        
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-dark);
            margin: 0; padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            user-select: none;
        }

        /* --- 2. COMPONENTS --- */
        .hidden { display: none !important; }
        
        /* Spinner */
        #loading-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.9); z-index: 2000;
            display: flex; justify-content: center; align-items: center;
            backdrop-filter: blur(4px);
        }
        .spinner {
            width: 45px; height: 45px;
            border: 4px solid #f0f0f0; border-top: 4px solid var(--primary-blue);
            border-radius: 50%; animation: spin 0.8s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Buttons */
        .btn-primary {
            width: 100%; padding: 16px;
            background: var(--primary-blue);
            color: white; border: none; border-radius: 8px;
            font-size: 15px; font-weight: 600; letter-spacing: 0.5px;
            cursor: pointer; transition: background 0.2s;
            box-shadow: 0 4px 12px rgba(45, 117, 200, 0.2);
        }
        .btn-primary:active { transform: scale(0.99); background: var(--secondary-blue); }
        
        .btn-link {
            background: none; border: none;
            color: var(--primary-blue); font-weight: 600;
            cursor: pointer; font-size: 14px; padding: 5px;
        }

        /* Inputs */
        .input-group { margin-bottom: 18px; position: relative; }
        .input-field {
            width: 100%; padding: 14px 16px;
            border: 1px solid var(--input-border); border-radius: 8px;
            font-size: 15px; background: white; color: var(--text-dark);
            transition: border-color 0.2s;
        }
        .input-field:focus { border-color: var(--primary-blue); }
        
        /* Phone Group */
        .phone-group { display: flex; gap: 10px; }
        .phone-select {
            width: 110px; padding: 14px;
            border: 1px solid var(--input-border); border-radius: 8px;
            background: white; font-size: 15px; color: var(--text-dark);
        }

        /* --- 3. AUTH SECTION --- */
        #auth-section {
            flex: 1; display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            padding: 20px; width: 100%;
        }
        .auth-wrapper {
            width: 100%; max-width: 420px;
            background: white; padding: 40px;
            border-radius: 16px;
            box-shadow: var(--card-shadow);
        }
        
        .logo-container { text-align: center; margin-bottom: 35px; }
        .app-logo {
            width: 72px; height: 72px;
            border-radius: 50%;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            object-fit: cover; margin-bottom: 15px;
        }
        .brand-title { color: var(--text-dark); font-size: 22px; font-weight: 700; margin: 0; }
        .brand-subtitle { color: var(--text-grey); font-size: 13px; margin-top: 6px; }

        .password-wrapper { position: relative; }
        .toggle-password {
            position: absolute; right: 15px; top: 15px;
            cursor: pointer; color: #999; font-size: 18px;
        }

        /* --- 4. DASHBOARD SECTION (Corporate Style) --- */
        #dashboard-section {
            padding: 20px; padding-bottom: 50px;
            width: 100%; display: flex; justify-content: center;
            min-height: 100vh;
        }
        .dashboard-wrapper { width: 100%; max-width: 900px; }
        
        /* Dashboard Header */
        .dash-header {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 30px; background: white;
            padding: 20px 25px; border-radius: 12px;
            box-shadow: var(--card-shadow);
            border-left: 5px solid var(--primary-blue);
        }
        .user-info h2 { margin: 0; font-size: 18px; font-weight: 700; color: var(--text-dark); }
        .user-info p { margin: 4px 0 0; font-size: 13px; color: var(--text-grey); }
        
        /* Grid */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
        }
        
        /* Modern Clean Cards */
        .course-card {
            background: white; border-radius: 12px;
            padding: 25px 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
            border: 1px solid #eee;
            cursor: pointer; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            display: flex; flex-direction: column; align-items: center; text-align: center;
            position: relative; overflow: hidden;
        }
        .course-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(45, 117, 200, 0.15);
            border-color: rgba(45, 117, 200, 0.3);
        }
        
        /* SVG Icons */
        .icon-box {
            width: 48px; height: 48px;
            margin-bottom: 15px;
            display: flex; justify-content: center; align-items: center;
        }
        .icon-box svg { width: 100%; height: 100%; fill: var(--primary-blue); }
        
        .course-name { 
            font-weight: 600; color: var(--text-dark); 
            font-size: 15px; margin-bottom: 20px; 
            flex-grow: 1;
        }
        
        /* Minimal Status Indicator */
        .status-dot {
            height: 4px; width: 40px; border-radius: 2px;
        }
        .dot-locked { background-color: #E0E0E0; }
        .dot-open { background-color: var(--success-green); }
        
        .card-footer {
            width: 100%; font-size: 13px; font-weight: 700; letter-spacing: 0.5px;
            padding-top: 12px; border-top: 1px solid #f5f5f5;
            color: var(--text-grey);
            text-transform: uppercase;
        }
        .card-footer.active { color: var(--success-green); }
        .card-footer.locked { color: var(--highlight-orange); }

        /* --- 5. MODALS --- */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 3000;
            display: flex; justify-content: center; align-items: center; padding: 20px;
            backdrop-filter: blur(3px);
        }
        .modal-content {
            background: white; padding: 30px; border-radius: 16px;
            width: 100%; max-width: 380px; text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>

    <div id="loading-overlay" class="hidden"><div class="spinner"></div></div>

    <div id="auth-section">
        <div class="auth-wrapper">
            <div class="logo-container">
                <img src="https://lh3.googleusercontent.com/d/1yFivjS463NWwftZxyij-lmK3wM0vOVmt" class="app-logo" alt="Logo">
                <h2 class="brand-title">Revision Test</h2>
                <p class="brand-subtitle">Professional Exam Series</p>
            </div>

            <div id="login-form">
                <div class="input-group">
                    <input type="email" id="login-email" class="input-field" placeholder="Email Address" autocapitalize="none">
                </div>
                <div class="input-group password-wrapper">
                    <input type="password" id="login-pass" class="input-field" placeholder="Password">
                    <span class="toggle-password" onclick="togglePass('login-pass')">üëÅÔ∏è</span>
                </div>
                <button class="btn-primary" onclick="handleLogin()">Sign In</button>
                
                <div style="display: flex; justify-content: space-between; margin-top: 18px; font-size: 13px;">
                    <span style="color: #666">No account? <strong onclick="switchAuth('signup')" style="color:var(--primary-blue); cursor:pointer">Sign Up</strong></span>
                    <strong onclick="showForgotModal()" style="color:var(--highlight-orange); cursor:pointer">Forgot Password?</strong>
                </div>
            </div>

            <div id="signup-form" class="hidden">
                <div class="input-group">
                    <input type="text" id="signup-name" class="input-field" placeholder="Full Name *">
                </div>
                <div class="input-group">
                    <input type="email" id="signup-email" class="input-field" placeholder="Email Address *" autocapitalize="none">
                </div>
                
                <div class="input-group phone-group">
                    <select id="country-code" class="phone-select">
                        <option value="+91">+91 (IN)</option>
                        <option value="+1">+1 (US)</option>
                        <option value="+44">+44 (UK)</option>
                        <option value="+61">+61 (AU)</option>
                        <option value="+971">+971 (UAE)</option>
                        <option value="+65">+65 (SG)</option>
                        <option value="">Other</option>
                    </select>
                    <input type="tel" id="signup-phone" class="input-field" placeholder="Mobile Number *" pattern="[0-9]*">
                </div>

                <div class="input-group password-wrapper">
                    <input type="password" id="signup-pass" class="input-field" placeholder="Create Password *">
                    <span class="toggle-password" onclick="togglePass('signup-pass')">üëÅÔ∏è</span>
                </div>
                <button class="btn-primary" onclick="handleSignup()">Create Account</button>
                
                <div style="text-align: center; margin-top: 18px; font-size: 13px;">
                    <span style="color: #666">Already a member? <strong onclick="switchAuth('login')" style="color:var(--primary-blue); cursor:pointer">Sign In</strong></span>
                </div>
            </div>
        </div>
    </div>

    <div id="dashboard-section" class="hidden">
        <div class="dashboard-wrapper">
            <div class="dash-header">
                <div class="user-info">
                    <h2 id="user-name-display">Welcome Back</h2>
                    <p>Select a course to proceed</p>
                </div>
                <img src="https://lh3.googleusercontent.com/d/1yFivjS463NWwftZxyij-lmK3wM0vOVmt" style="width: 40px; height: 40px; border-radius: 50%;" alt="Profile">
            </div>

            <div class="grid-container" id="course-grid">
                </div>
            
            <div style="text-align: center; margin-top: 40px;">
                 <button class="btn-link" onclick="handleLogout()" style="color: #e74c3c; opacity:0.8;">Sign Out</button>
            </div>
        </div>
    </div>

    <div id="forgot-modal" class="modal hidden">
        <div class="modal-content">
            <h3 style="margin-top:0; color:var(--text-dark)">Reset Password</h3>
            <p style="color:#666; font-size:14px; line-height:1.6;">Contact support to recover your account.</p>
            <div style="background:#f8f9fa; padding:15px; border-radius:8px; margin:20px 0; text-align:left; font-size:14px;">
                <div style="margin-bottom:8px">üìß revisiontestapp@gmail.com</div>
                <div>üìû +91 8754955367</div>
            </div>
            <button class="btn-primary" style="background:#eee; color:#333; box-shadow:none;" onclick="closeModal('forgot-modal')">Close</button>
        </div>
    </div>

    <div id="paywall-modal" class="modal hidden">
        <div class="modal-content">
            <div style="font-size: 36px; margin-bottom: 15px;">üîí</div>
            <h3 style="margin:0 0 10px; color: var(--text-dark);">Course Locked</h3>
            <p style="color:#666; font-size:14px; margin-bottom:25px; line-height:1.5;">
                You must purchase the <strong id="paywall-course-name" style="color:var(--primary-blue)"></strong> course to access this content.
            </p>
            <button class="btn-primary" onclick="closeModal('paywall-modal')">OK, Got it</button>
        </div>
    </div>

    <script>
        // CONFIG
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyH8Jv7hR9V-TEOgh5T0ALnmNP2UWcpDkB4MRZmX6XpaeVyTs7xV3oPR9prgodNVrXs/exec";
        
        let deviceId = localStorage.getItem('device_id') || 'web_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('device_id', deviceId);

        // SVG Icons
        const ICONS = {
            medical: '<svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-1.99.9-1.99 2L3 19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-1 11h-4v4h-4v-4H6v-4h4V6h4v4h4v4z"/></svg>',
            engineer: '<svg viewBox="0 0 24 24"><path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"/></svg>',
            gov: '<svg viewBox="0 0 24 24"><path d="M4 10v7h3v-7H4zm6 0v7h3v-7h-3zM2 22h19v-3H2v3zm14-12v7h3v-7h-3zm-4.5-9L2 6v2h19V6l-9.5-5z"/></svg>',
            chart: '<svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg>',
            train: '<svg viewBox="0 0 24 24"><path d="M12 2c-4 0-8 .5-8 4v9.5C4 17.43 5.57 19 7.5 19L6 20.5v.5h2.23l2-2H14l2 2h2v-.5L16.5 19c1.93 0 3.5-1.57 3.5-3.5V6c0-3.5-3.58-4-8-4zM7.5 17c-.83 0-1.5-.67-1.5-1.5S6.67 14 7.5 14s1.5.67 1.5 1.5S8.33 17 7.5 17zm3.5-7H6V6h5v4zm2 0V6h5v4h-5zm3.5 7c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>',
            bank: '<svg viewBox="0 0 24 24"><path d="M4 10h3v7H4zM10.5 10h3v7h-3zM2 19h20v3H2zM17 10h3v7h-3zM12 1L2 6v2h20V6z"/></svg>',
            globe: '<svg viewBox="0 0 24 24"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zm6.93 6h-2.95c-.32-1.25-.78-2.45-1.38-3.56 1.84.63 3.37 1.91 4.33 3.56zM12 4.04c.83 1.2 1.48 2.53 1.91 3.96h-3.82c.43-1.43 1.08-2.76 1.91-3.96zM4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2H4.26zm.82 2h2.95c.32 1.25.78 2.45 1.38 3.56-1.84-.63-3.37-1.9-4.33-3.56zm2.95-8H5.08c.96-1.66 2.49-2.93 4.33-3.56-.6 1.11-1.06 2.31-1.38 3.56zM12 19.96c-.83-1.2-1.48-2.53-1.91-3.96h3.82c-.43 1.43-1.08 2.76-1.91 3.96zM14.34 14H9.66c-.09-.66-.16-1.32-.16-2 0-.68.07-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2zm.25 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95c-.96 1.65-2.49 2.93-4.33 3.56zM16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2h-3.38z"/></svg>'
        };

        const COURSES = [
            { id: "NEET", name: "NEET", icon: ICONS.medical },
            { id: "JEE", name: "JEE", icon: ICONS.engineer },
            { id: "UPSC", name: "UPSC", icon: ICONS.gov },
            { id: "SSC_CGL", name: "SSC CGL", icon: ICONS.chart },
            { id: "SSC_CHSL", name: "SSC CHSL", icon: ICONS.chart },
            { id: "RRB_NTPC", name: "RRB NTPC", icon: ICONS.train },
            { id: "BANKING", name: "Banking", icon: ICONS.bank },
            { id: "IELTS", name: "IELTS", icon: ICONS.globe },
            { id: "OET", name: "OET", icon: ICONS.medical }
        ];

        let userPermissions = {};

        // UTILS
        function el(id) { return document.getElementById(id); }
        function show(id) { el(id).classList.remove('hidden'); }
        function hide(id) { el(id).classList.add('hidden'); }
        
        function togglePass(id) {
            const x = el(id);
            x.type = x.type === "password" ? "text" : "password";
        }

        function switchAuth(type) {
            type === 'signup' ? (hide('login-form'), show('signup-form')) : (hide('signup-form'), show('login-form'));
        }

        // --- SIGNUP LOGIC (Lowercase Email + Compulsory Fields) ---
        function handleSignup() {
            const name = el('signup-name').value.trim();
            // Force Lowercase for Email
            const email = el('signup-email').value.trim().toLowerCase();
            const pass = el('signup-pass').value.trim();
            const countryCode = el('country-code').value;
            const phoneNum = el('signup-phone').value.trim();

            if(!name || !email || !pass || !phoneNum || !countryCode) {
                return alert("All fields are mandatory.");
            }

            const fullPhone = countryCode + phoneNum;

            apiCall({ 
                action: 'signup', name: name, email: email, 
                phone: fullPhone, password: pass, deviceId: deviceId 
            }, (res) => {
                if(res.status === 'success') {
                    alert("Account Created! Please Sign In.");
                    switchAuth('login');
                } else {
                    alert(res.message);
                }
            });
        }

        // --- LOGIN LOGIC (Lowercase Email) ---
        function handleLogin() {
            // Force Lowercase for Email match
            const email = el('login-email').value.trim().toLowerCase();
            const pass = el('login-pass').value.trim();
            
            if(!email || !pass) return alert("Enter email and password.");
            
            apiCall({ action: 'login', email: email, password: pass, deviceId: deviceId }, (res) => {
                if(res.status === 'success') {
                    userPermissions = res.permissions;
                    localStorage.setItem('user_email', email);
                    el('user-name-display').innerText = "Hello, Student"; 
                    loadDashboard();
                } else {
                    alert(res.message);
                }
            });
        }

        // --- MODERN DASHBOARD RENDERER ---
        function loadDashboard() {
            hide('auth-section');
            show('dashboard-section');
            
            const grid = el('course-grid');
            grid.innerHTML = "";
            
            COURSES.forEach(course => {
                const isUnlocked = userPermissions[course.id] === true;
                
                const card = document.createElement('div');
                card.className = 'course-card';
                card.onclick = () => checkPermission(course.id, course.name);
                
                // UPDATED LABEL: "ENTER" + Arrow
                card.innerHTML = `
                    <div class="icon-box">${course.icon}</div>
                    <div class="course-name">${course.name}</div>
                    <div class="status-dot ${isUnlocked ? 'dot-open' : 'dot-locked'}"></div>
                    <div class="card-footer ${isUnlocked ? 'active' : 'locked'}">
                        ${isUnlocked ? 'ENTER ‚ûî' : 'LOCKED'}
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function checkPermission(courseKey, courseName) {
            if (userPermissions[courseKey] === true) {
                window.location.href = courseKey + ".html";
            } else {
                el('paywall-course-name').innerText = courseName;
                show('paywall-modal');
            }
        }

        function handleLogout() {
            localStorage.removeItem('user_email');
            location.reload();
        }

        function apiCall(data, cb) {
            show('loading-overlay');
            fetch(SCRIPT_URL, {
                method: 'POST', body: JSON.stringify(data)
            }).then(r => r.json()).then(d => {
                hide('loading-overlay'); cb(d);
            }).catch(e => {
                hide('loading-overlay'); alert("Connection error.");
            });
        }

        function showForgotModal() { show('forgot-modal'); }
        function closeModal(id) { hide(id); }
        document.addEventListener('contextmenu', e => e.preventDefault());
    </script>
</body>
</html>
